# Руководство по миграции: Поддержка нескольких категорий

## Что изменилось

Схема постов была обновлена для поддержки нескольких категорий вместо одной:

- **Было**: `category: reference` (одна категория)
- **Стало**: `categories: array` (массив категорий)

## Файлы, которые были изменены

1. `sanity/schemas/post.ts` - обновлена схема поста
2. `lib/types.ts` - обновлены TypeScript типы
3. `lib/sanity.ts` - обновлены GROQ запросы
4. `app/blog/[slug]/page.tsx` - обновлено отображение поста
5. `app/page.tsx` - обновлено отображение списка постов

## Как выполнить миграцию

### Вариант 1: Автоматическая миграция (рекомендуется)

1. Откройте Sanity Studio (`/studio`)
2. Перейдите в раздел "Tools" → "Scripts"
3. Создайте новый скрипт и вставьте код из `scripts/migrate-categories.js`
4. Запустите скрипт

### Вариант 2: Ручная миграция

1. Откройте каждый пост в Sanity Studio
2. В поле "Категории" добавьте существующую категорию
3. Удалите старое поле "Категория"
4. Сохраните изменения

## Что проверить после миграции

1. Все посты отображают категории корректно
2. Связанные посты работают правильно
3. Фильтрация по категориям функционирует
4. Нет ошибок в консоли браузера

## Откат изменений

Если нужно вернуться к старой схеме:

1. Восстановите старую схему в `sanity/schemas/post.ts`
2. Обновите типы в `lib/types.ts`
3. Восстановите старые запросы в `lib/sanity.ts`
4. Обновите компоненты для работы с одной категорией

## Примечания

- После миграции все существующие посты будут иметь массив с одной категорией
- Новые посты могут иметь несколько категорий
- Связанные посты теперь учитывают все категории поста
